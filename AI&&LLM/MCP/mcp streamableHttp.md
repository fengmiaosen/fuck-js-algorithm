`MCP streamableHttp` æ˜¯ä¸€ä¸ªæŠ€æœ¯æœ¯è¯­ï¼Œå®ƒæè¿°äº†ä¸€ç§åœ¨ **æ¨¡å‹ä¸Šä¸‹æ–‡åè®® (MCP)** ä¸­è¿›è¡Œç½‘ç»œé€šä¿¡çš„ç°ä»£åŒ–ä¼ è¾“æ–¹å¼ã€‚

ç®€å•æ¥è¯´ï¼Œæ‚¨å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ç§ä¸“ä¸º AI æ¨¡å‹è®¾è®¡çš„ã€é«˜æ•ˆçš„â€œç½‘ç»œè¿æ¥çº¿â€ã€‚

ä¸ºäº†å¸®æ‚¨å½»åº•ç†è§£ï¼Œæˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹è¿™ä¸ªè¯ï¼š

  * **MCP (Model Context Protocol)**ï¼šæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ã€‚

      * è¿™æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œç›®æ ‡æ˜¯æˆä¸ºâ€œAI çš„ USB-C æ¥å£â€ã€‚
      * å®ƒçš„ä½œç”¨æ˜¯ï¼š**æ ‡å‡†åŒ– AI æ¨¡å‹ï¼ˆå¦‚å¤§å‹è¯­è¨€æ¨¡å‹ï¼‰ä¸å¤–éƒ¨å·¥å…·ã€æ•°æ®æºï¼ˆå¦‚ APIã€æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿï¼‰å¯¹è¯çš„æ–¹å¼ã€‚**
      * AI æ¨¡å‹æ˜¯â€œå®¢æˆ·ç«¯â€ï¼Œå¤–éƒ¨å·¥å…·æ˜¯â€œæœåŠ¡å™¨â€ã€‚

  * **Streamable HTTP**ï¼šå¯æµå¼ä¼ è¾“çš„ HTTPã€‚

      * è¿™æ˜¯å®ç° MCP åè®®çš„ä¸€ç§å…·ä½“çš„**ä¼ è¾“æ–¹å¼**ï¼ˆTransportï¼‰ã€‚
      * å®ƒå‘Šè¯‰â€œå®¢æˆ·ç«¯â€å’Œâ€œæœåŠ¡å™¨â€å…·ä½“åº”è¯¥å¦‚ä½•é€šè¿‡ HTTP åè®®æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚

-----

### ğŸš€ æ ¸å¿ƒç‰¹æ€§ï¼šå®ƒä¸ºä»€ä¹ˆå« "Streamable"ï¼Ÿ

`streamableHttp` æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å®ƒå¦‚ä½•å¤„ç†é€šä¿¡ï¼Œè¿™å¯ä»¥ç”¨ä¸€ä¸ªâ€œé¤å…ç‚¹é¤â€çš„ä¾‹å­æ¥ç”ŸåŠ¨è¯´æ˜ï¼š

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ï¼ˆAI æ¨¡å‹ï¼‰è¦å»ä¸€å®¶é«˜ç§‘æŠ€é¤å…ï¼ˆå·¥å…·æœåŠ¡å™¨ï¼‰ç‚¹é¤ï¼š

1.  **ä¸€ä¸ªç»Ÿä¸€çš„æœåŠ¡çª—å£ (Single Endpoint)**ï¼š

      * ä½ åªéœ€è¦å»ä¸€ä¸ªæœåŠ¡çª—å£ï¼ˆæ¯”å¦‚ `/mcp`ï¼‰å°±èƒ½åŠæ‰€æœ‰äº‹ã€‚
      * è¿™æ¯”è€å¼é¤å…éœ€è¦å…ˆå»Açª—å£ç‚¹é¤ï¼Œå†å»Bçª—å£å–é¤ï¼ˆè€å¼çš„ HTTP+SSE æ–¹æ¡ˆï¼‰è¦ç®€å•å¾—å¤šã€‚

2.  **ç‚¹é¤ (HTTP POST)**ï¼š

      * ä½ é€šè¿‡ `POST` è¯·æ±‚å‘è¿™ä¸ªçª—å£æäº¤ä½ çš„â€œè®¢å•â€ï¼ˆæ¯”å¦‚ï¼šâ€œå¸®æˆ‘è®¡ç®— 2+2â€ï¼‰ã€‚
      * é¤å…ï¼ˆæœåŠ¡å™¨ï¼‰å¯ä»¥**ç«‹å³**ç»™ä½ ä¸€ä¸ªç®€å•çš„å›å¤ï¼ˆæ¯”å¦‚ï¼šâ€œè®¡ç®—ç»“æœæ˜¯ 4â€ï¼‰ã€‚

3.  **ï¼ˆå¯é€‰ï¼‰å–é¤å‘¼å«å™¨ (Server-Sent Events, SSE)**ï¼š

      * è¿™æ˜¯æœ€å…³é”®çš„â€œStreamableâ€éƒ¨åˆ†ã€‚å¦‚æœä½ ç‚¹çš„èœï¼ˆæ‰§è¡Œçš„ä»»åŠ¡ï¼‰å¾ˆå¤æ‚ï¼Œæ¯”å¦‚â€œåˆ†æä¸€ä»½100é¡µçš„æŠ¥å‘Šâ€ã€‚
      * é¤å…ä¼šç»™ä½ ä¸€ä¸ªâ€œå‘¼å«å™¨â€ï¼ˆé€šè¿‡ `GET` è¯·æ±‚å»ºç«‹ä¸€ä¸ª SSE è¿æ¥ï¼‰ã€‚
      * ä½ ä¸ç”¨ä¸€ç›´ç«™ç€ç­‰ï¼Œé¤å…ä¼šé€šè¿‡è¿™ä¸ªå‘¼å«å™¨**ä¸»åŠ¨ã€åˆ†æ‰¹æ¬¡åœ°**å‘ä½ å‘é€æ›´æ–°ï¼š
          * â€œå®ï¼æˆ‘ä»¬å¼€å§‹åˆ†ææŠ¥å‘Šäº†...â€
          * â€œå®ï¼å·²å®Œæˆ50%...â€
          * â€œå®ï¼å‘ç°ä¸€ä¸ªé‡ç‚¹...â€
          * â€œå®ï¼åˆ†æå®Œæ¯•ï¼Œè¿™æ˜¯æ€»ç»“...â€

è¿™ç§æ–¹å¼ï¼ˆä¸€ä¸ª `POST` é€šé“ç”¨äºå‘½ä»¤ï¼Œä¸€ä¸ª `GET` é€šé“ç”¨äºæ¥æ”¶æµå¼æ›´æ–°ï¼‰éƒ½åœ¨åŒä¸€ä¸ª URL ç«¯ç‚¹ä¸Šå®Œæˆï¼Œå› æ­¤å®ƒæ—¢é«˜æ•ˆã€ç®€å•ï¼Œåˆèƒ½å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ã€éœ€è¦é€æ­¥è¿”å›ç»“æœçš„å¤æ‚ä»»åŠ¡ã€‚

-----

### ğŸ§ å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

å®ƒä¸»è¦è§£å†³äº† AI Agentï¼ˆæ™ºèƒ½ä½“ï¼‰åœ¨è°ƒç”¨å¤–éƒ¨å·¥å…·æ—¶çš„ä¸¤ä¸ªé—®é¢˜ï¼š

1.  **å®æ—¶æ€§ä¸æ•ˆç‡**ï¼šå¯¹äºéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼ˆå¦‚ä»£ç æ‰§è¡Œã€æ•°æ®åˆ†æã€è°ƒç”¨æ…¢é€Ÿ APIï¼‰ï¼ŒAI ä¸å¿…â€œå¡ä½â€ç­‰å¾…ä¸€ä¸ªå®Œæ•´çš„æœ€ç»ˆç»“æœã€‚æœåŠ¡å™¨å¯ä»¥æµå¼åœ°ï¼ˆstreamï¼‰å‘å›è¿›åº¦æ›´æ–°æˆ–éƒ¨åˆ†ç»“æœï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒã€‚
2.  **ç®€æ´æ€§**ï¼šå®ƒå°†è€å¼æ–¹æ¡ˆä¸­å¤æ‚çš„åŒç«¯ç‚¹ï¼ˆä¸€ä¸ªç”¨äº `POST`ï¼Œä¸€ä¸ªç”¨äº `SSE`ï¼‰åˆå¹¶ä¸ºä¸€ä¸ªï¼Œå¤§å¤§ç®€åŒ–äº†æœåŠ¡å™¨çš„å®ç°å’Œå®¢æˆ·ç«¯çš„é…ç½®ã€‚

-----

### ğŸ› ï¸ ç®€å•ä»£ç ç¤ºä¾‹ (ä½¿ç”¨ Python çš„ `fastmcp` åº“)

ä¸‹é¢æ˜¯ä¸€ä¸ªæç®€çš„â€œå¤©æ°”å·¥å…·â€æœåŠ¡å™¨ç¤ºä¾‹ï¼Œè®©æ‚¨æ„Ÿå—ä¸€ä¸‹å®ƒåœ¨ä»£ç ä¸­æ˜¯ä»€ä¹ˆæ ·çš„ï¼š

#### 1\. æœåŠ¡å™¨ç«¯ (server.py)

```python
from fastmcp import FastMCP
import uvicorn

# 1. åˆå§‹åŒ– MCP æœåŠ¡å™¨
mcp = FastMCP("weather-server")

# 2. å®šä¹‰ä¸€ä¸ªâ€œå·¥å…·â€
@mcp.tool()
def get_weather(city: str) -> str:
    """è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯"""
    print(f"æ­£åœ¨æŸ¥è¯¢ {city} çš„å¤©æ°”...")
    # å®é™…åœºæ™¯ä¸­è¿™é‡Œä¼šè°ƒç”¨ä¸€ä¸ªçœŸæ­£çš„å¤©æ°” API
    if city == "åŒ—äº¬":
        return "æ™´æœ—, 25Â°C"
    else:
        return "å¤šäº‘, 22Â°C"

# 3. å¯åŠ¨æœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šä½¿ç”¨ "streamable-http" ä¼ è¾“æ–¹å¼
if __name__ == "__main__":
    # mcp.run() ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª FastAPI åº”ç”¨
    # å¹¶åœ¨ /mcp è·¯å¾„ä¸Šæä¾› streamableHttp ç«¯ç‚¹
    uvicorn.run(
        mcp.run(transport="streamable-http"), 
        host="127.0.0.1", 
        port=8000
    )
```

#### 2\. å®¢æˆ·ç«¯ (client.py)

```python
import asyncio
from mcp.client.streamable_http import streamablehttp_client
from mcp import ClientSession

async def main():
    server_url = "http://127.0.0.1:8000/mcp"

    # 1. è¿æ¥åˆ° streamableHttp æœåŠ¡å™¨
    async with streamablehttp_client(server_url) as (reader, writer, _):
        async with ClientSession(reader, writer) as session:
            
            # 2. (å¯é€‰) æŸ¥çœ‹æœåŠ¡å™¨ä¸Šæœ‰å“ªäº›å·¥å…·
            tools = await session.list_tools()
            print(f"å¯ç”¨çš„å·¥å…·: {[t.name for t in tools.tools]}")

            # 3. è°ƒç”¨å·¥å…·
            print("æ­£åœ¨è°ƒç”¨ 'get_weather' å·¥å…·...")
            result = await session.call_tool(
                name="get_weather",
                arguments={"city": "åŒ—äº¬"}
            )
            
            # 4. æ‰“å°ç»“æœ
            print(f"æœåŠ¡å™¨è¿”å›çš„ç»“æœ: {result.content}")

if __name__ == "__main__":
    asyncio.run(main())
```

**å¦‚ä½•è¿è¡Œï¼š**

1.  å®‰è£…ä¾èµ–: `pip install fastmcp uvicorn mcp-client`
2.  è¿è¡ŒæœåŠ¡å™¨: `python server.py`
3.  åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œå®¢æˆ·ç«¯: `python client.py`

**å®¢æˆ·ç«¯è¾“å‡ºå°†ä¼šæ˜¯ï¼š**

```
å¯ç”¨çš„å·¥å…·: ['get_weather']
æ­£åœ¨è°ƒç”¨ 'get_weather' å·¥å…·...
æœåŠ¡å™¨è¿”å›çš„ç»“æœ: 'æ™´æœ—, 25Â°C'
```

-----

### æ€»ç»“

| æ–¹é¢ | è§£é‡Š |
| :--- | :--- |
| **å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ** | ä¸€ç§ç”¨äº **MCP åè®®**çš„ç°ä»£ç½‘ç»œä¼ è¾“æœºåˆ¶ã€‚ |
| **å®ƒå¦‚ä½•å·¥ä½œï¼Ÿ** | ä½¿ç”¨**å•ä¸ª HTTP ç«¯ç‚¹**ï¼Œé€šè¿‡ `POST` å‘é€å‘½ä»¤ï¼Œé€šè¿‡ `GET` å»ºç«‹å¯é€‰çš„ **SSE** è¿æ¥æ¥æ¥æ”¶æµå¼å“åº”ã€‚ |
| **ä¸ºä»€ä¹ˆç”¨å®ƒï¼Ÿ** | **ç®€æ´** (å•ä¸ªURL) ä¸”**é«˜æ•ˆ** (æ”¯æŒæµå¼ä¼ è¾“)ï¼Œéå¸¸é€‚åˆéœ€è¦å®æ—¶åé¦ˆæˆ–å¤„ç†é•¿æ—¶ä»»åŠ¡çš„ AI å·¥å…·ã€‚|
| **åœ¨å“ªé‡Œèƒ½çœ‹åˆ°ï¼Ÿ** | **Spring AI**ã€**OpenAI Agents SDK**ã€**Ray Serve** ä»¥åŠå„ç§ Python (`fastmcp`) å’Œ TypeScript åº“ä¸­ã€‚ |

### å‚è€ƒèµ„æ–™

### å‚è€ƒèµ„æ–™

- [å¤§æ¨¡å‹ MCP æ›´é«˜æ•ˆçš„é€šä¿¡ï¼šStreamableHTTP åè®®](https://blog.csdn.net/zhangzhentiyes/article/details/147855601)
- [playwright-mcp](https://github.com/microsoft/playwright-mcp)
- [é­”æ­ç¤¾åŒº MCP èµ„æº](https://modelscope.cn/mcp)
- [Cherry Studio](https://www.cherry-ai.com/)
