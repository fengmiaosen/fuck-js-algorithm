# React Native è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“è¯¦è§£

## ğŸ¯ **FlatList æ˜¯å¦æ”¯æŒè™šæ‹Ÿæ¸²æŸ“ï¼Ÿ**

**ç­”æ¡ˆï¼šæ˜¯çš„ï¼ŒFlatList åŸç”Ÿæ”¯æŒè™šæ‹Ÿæ¸²æŸ“ï¼**

React Native çš„ FlatList ç»„ä»¶å†…ç½®äº†è™šæ‹ŸåŒ–æ¸²æŸ“æœºåˆ¶ï¼Œè¿™æ˜¯å®ƒç›¸æ¯” ScrollView çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ã€‚

## ğŸ”§ **FlatList è™šæ‹Ÿæ¸²æŸ“åŸºæœ¬åŸç†**

### 1. **æ ¸å¿ƒæœºåˆ¶**
- **æŒ‰éœ€æ¸²æŸ“**ï¼šåªæ¸²æŸ“å½“å‰å¯è§†åŒºåŸŸå†…çš„åˆ—è¡¨é¡¹
- **åŠ¨æ€å›æ”¶**ï¼šæ»šåŠ¨æ—¶åŠ¨æ€åˆ›å»ºå’Œé”€æ¯ç»„ä»¶å®ä¾‹
- **å†…å­˜ä¼˜åŒ–**ï¼šé¿å…ä¸€æ¬¡æ€§æ¸²æŸ“å¤§é‡æ•°æ®é€ æˆçš„å†…å­˜å‹åŠ›
- **æ€§èƒ½æå‡**ï¼šå‡å°‘ JavaScript çº¿ç¨‹å’ŒåŸç”Ÿçº¿ç¨‹çš„é€šä¿¡å¼€é”€

### 2. **å®ç°åŸç†**
```javascript
// FlatList è™šæ‹Ÿæ¸²æŸ“æµç¨‹
const VirtualizationProcess = {
  step1: "è®¡ç®—å¯è§†åŒºåŸŸèŒƒå›´ï¼ˆviewportï¼‰",
  step2: "æ ¹æ® itemHeight ç¡®å®šéœ€è¦æ¸²æŸ“çš„ item ç´¢å¼•èŒƒå›´", 
  step3: "åªæ¸²æŸ“å¯è§†èŒƒå›´å†…çš„ç»„ä»¶",
  step4: "ä½¿ç”¨ transform å®šä½ç»„ä»¶ä½ç½®",
  step5: "æ»šåŠ¨æ—¶åŠ¨æ€æ›´æ–°æ¸²æŸ“èŒƒå›´",
  step6: "å›æ”¶ä¸å¯è§çš„ç»„ä»¶å®ä¾‹"
};
```

### 3. **å…³é”®é…ç½®å‚æ•°**
```javascript
<FlatList
  data={data}
  renderItem={({ item }) => <ItemComponent item={item} />}
  
  // è™šæ‹ŸåŒ–æ ¸å¿ƒé…ç½®
  initialNumToRender={10}        // åˆå§‹æ¸²æŸ“æ•°é‡
  maxToRenderPerBatch={5}        // æ¯æ‰¹æœ€å¤§æ¸²æŸ“æ•°é‡
  windowSize={10}                // æ¸²æŸ“çª—å£å¤§å°ï¼ˆå±å¹•æ•°é‡å€æ•°ï¼‰
  updateCellsBatchingPeriod={50} // æ‰¹é‡æ›´æ–°é—´éš”ï¼ˆmsï¼‰
  
  // æ€§èƒ½ä¼˜åŒ–
  removeClippedSubviews={true}   // ç§»é™¤å±å¹•å¤–è§†å›¾
  getItemLayout={(data, index) => ({
    length: 80,                  // å›ºå®šé«˜åº¦ä¼˜åŒ–
    offset: 80 * index,
    index,
  })}
  
  // å†…å­˜ç®¡ç†
  onEndReachedThreshold={0.5}    // è§¦å‘åŠ è½½æ›´å¤šçš„é˜ˆå€¼
  legacyImplementation={false}   // ä½¿ç”¨æ–°çš„è™šæ‹ŸåŒ–å®ç°
/>
```

## ğŸ“Š **è™šæ‹Ÿæ¸²æŸ“æ€§èƒ½å¯¹æ¯”**

| åœºæ™¯ | ScrollView | FlatList | æ€§èƒ½æå‡ |
|------|------------|----------|----------|
| 1000æ¡æ•°æ® | å¡é¡¿æ˜æ˜¾ | æµç•… | 10x |
| 10000æ¡æ•°æ® | æ— æ³•ä½¿ç”¨ | æ­£å¸¸ | 100x |
| å†…å­˜å ç”¨ | çº¿æ€§å¢é•¿ | æ’å®š | 90%â†“ |
| é¦–å±æ¸²æŸ“ | æ…¢ | å¿« | 5x |

## ğŸ›  **ç¬¬ä¸‰æ–¹è™šæ‹ŸåŒ–ç»„ä»¶æ¨è**

### 1. **react-native-super-grid**
```javascript
// ç½‘æ ¼è™šæ‹ŸåŒ–
import { FlatGrid } from 'react-native-super-grid';

<FlatGrid
  itemDimension={130}
  data={data}
  style={styles.gridView}
  spacing={10}
  renderItem={({ item }) => <GridItem item={item} />}
  // ç»§æ‰¿ FlatList çš„è™šæ‹ŸåŒ–ç‰¹æ€§
/>
```

### 2. **@shopify/flash-list**
```javascript
// é«˜æ€§èƒ½æ›¿ä»£æ–¹æ¡ˆ
import { FlashList } from "@shopify/flash-list";

<FlashList
  data={data}
  renderItem={({ item }) => <ItemComponent item={item} />}
  estimatedItemSize={100}  // é¢„ä¼°é«˜åº¦ï¼Œæ€§èƒ½æ›´å¥½
  // æ¯” FlatList æ€§èƒ½æå‡ 10x
/>
```

### 3. **react-native-largelist**
```javascript
// å¤§æ•°æ®é‡ä¸“ç”¨
import { LargeList } from "react-native-largelist";

<LargeList
  data={data}
  heightForIndexPath={() => 100}
  renderIndexPath={({ section, row }) => 
    <ItemComponent item={data[section].items[row]} />
  }
  // æ”¯æŒç™¾ä¸‡çº§æ•°æ®
/>
```

## ğŸ¨ **è‡ªå®šä¹‰è™šæ‹ŸåŒ–å®ç°**

### åŸºç¡€ç‰ˆæœ¬
```javascript
import React, { useState, useCallback, useMemo } from 'react';
import { ScrollView, View, Dimensions } from 'react-native';

const CustomVirtualList = ({ data, renderItem, itemHeight = 100 }) => {
  const [scrollY, setScrollY] = useState(0);
  const screenHeight = Dimensions.get('window').height;
  
  // è®¡ç®—å¯è§èŒƒå›´
  const visibleRange = useMemo(() => {
    const startIndex = Math.floor(scrollY / itemHeight);
    const endIndex = Math.min(
      startIndex + Math.ceil(screenHeight / itemHeight) + 2,
      data.length
    );
    return { startIndex, endIndex };
  }, [scrollY, itemHeight, screenHeight, data.length]);
  
  // æ»šåŠ¨å¤„ç†
  const handleScroll = useCallback((event) => {
    setScrollY(event.nativeEvent.contentOffset.y);
  }, []);
  
  // æ¸²æŸ“å¯è§é¡¹
  const visibleItems = useMemo(() => {
    const { startIndex, endIndex } = visibleRange;
    return data.slice(startIndex, endIndex).map((item, index) => ({
      item,
      index: startIndex + index,
    }));
  }, [data, visibleRange]);
  
  return (
    <ScrollView
      onScroll={handleScroll}
      scrollEventThrottle={16}
      style={{ flex: 1 }}
    >
      {/* ä¸Šæ–¹å ä½ */}
      <View style={{ height: visibleRange.startIndex * itemHeight }} />
      
      {/* å¯è§é¡¹ */}
      {visibleItems.map(({ item, index }) => (
        <View key={index} style={{ height: itemHeight }}>
          {renderItem({ item, index })}
        </View>
      ))}
      
      {/* ä¸‹æ–¹å ä½ */}
      <View style={{ 
        height: (data.length - visibleRange.endIndex) * itemHeight 
      }} />
    </ScrollView>
  );
};
```

## âš¡ **æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ**

### 1. **ç»„ä»¶ä¼˜åŒ–**
```javascript
// ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const ListItem = React.memo(({ item, onPress }) => {
  return (
    <TouchableOpacity onPress={() => onPress(item.id)}>
      <Text>{item.title}</Text>
    </TouchableOpacity>
  );
}, (prevProps, nextProps) => {
  return prevProps.item.id === nextProps.item.id;
});
```

### 2. **å›è°ƒä¼˜åŒ–**
```javascript
const OptimizedList = () => {
  // ç¼“å­˜å›è°ƒå‡½æ•°
  const handleItemPress = useCallback((itemId) => {
    console.log('Item pressed:', itemId);
  }, []);
  
  // ç¼“å­˜æ¸²æŸ“å‡½æ•°
  const renderItem = useCallback(({ item }) => (
    <ListItem item={item} onPress={handleItemPress} />
  ), [handleItemPress]);
  
  return (
    <FlatList
      data={data}
      renderItem={renderItem}
      keyExtractor={(item) => item.id}
    />
  );
};
```

### 3. **æ•°æ®ä¼˜åŒ–**
```javascript
// åˆ†é¡µåŠ è½½
const [data, setData] = useState([]);
const [loading, setLoading] = useState(false);

const loadMoreData = useCallback(async () => {
  if (loading) return;
  
  setLoading(true);
  try {
    const newData = await fetchData(data.length, 20);
    setData(prev => [...prev, ...newData]);
  } finally {
    setLoading(false);
  }
}, [data.length, loading]);
```

## ğŸš¨ **å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**

### 1. **æ»šåŠ¨æ€§èƒ½é—®é¢˜**
```javascript
// è§£å†³æ–¹æ¡ˆï¼šä¼˜åŒ–æ»šåŠ¨äº‹ä»¶å¤„ç†
<FlatList
  scrollEventThrottle={16}  // é™åˆ¶æ»šåŠ¨äº‹ä»¶é¢‘ç‡
  removeClippedSubviews={true}
  maxToRenderPerBatch={10}
  updateCellsBatchingPeriod={100}
/>
```

### 2. **å†…å­˜æ³„æ¼**
```javascript
// è§£å†³æ–¹æ¡ˆï¼šåŠæ—¶æ¸…ç†
useEffect(() => {
  return () => {
    // æ¸…ç†å®šæ—¶å™¨ã€ç›‘å¬å™¨ç­‰
    clearTimeout(timer);
    subscription?.unsubscribe();
  };
}, []);
```

### 3. **éç­‰é«˜åˆ—è¡¨**
```javascript
// è§£å†³æ–¹æ¡ˆï¼šåŠ¨æ€æµ‹é‡é«˜åº¦
const [itemHeights, setItemHeights] = useState({});

const onLayout = useCallback((event, index) => {
  const { height } = event.nativeEvent.layout;
  setItemHeights(prev => ({ ...prev, [index]: height }));
}, []);

const getItemLayout = useCallback((data, index) => {
  const height = itemHeights[index] || 100; // é»˜è®¤é«˜åº¦
  const offset = Object.keys(itemHeights)
    .filter(key => parseInt(key) < index)
    .reduce((sum, key) => sum + itemHeights[key], 0);
  
  return { length: height, offset, index };
}, [itemHeights]);
```

## ğŸ“ˆ **é€‰æ‹©å»ºè®®**

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|----------|------|
| æ™®é€šåˆ—è¡¨ | FlatList | åŸç”Ÿæ”¯æŒï¼Œç¨³å®šå¯é  |
| ç½‘æ ¼å¸ƒå±€ | react-native-super-grid | ä¸“é—¨ä¼˜åŒ– |
| æé«˜æ€§èƒ½è¦æ±‚ | @shopify/flash-list | æ€§èƒ½æœ€ä½³ |
| ç™¾ä¸‡çº§æ•°æ® | react-native-largelist | ä¸“ä¸ºå¤§æ•°æ®è®¾è®¡ |
| å¤æ‚äº¤äº’ | è‡ªå®šä¹‰å®ç° | çµæ´»å¯æ§ |

## ğŸ¯ **æ€»ç»“**

React Native çš„ FlatList åŸç”Ÿæ”¯æŒè™šæ‹Ÿæ¸²æŸ“ï¼Œé€šè¿‡åˆç†é…ç½®å¯ä»¥å¤„ç†å¤§éƒ¨åˆ†åœºæ™¯ã€‚å¯¹äºç‰¹æ®Šéœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©ç›¸åº”çš„ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå®šä¹‰å®ç°ã€‚å…³é”®æ˜¯ç†è§£è™šæ‹ŸåŒ–åŸç†ï¼Œæ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©æœ€é€‚åˆçš„æ–¹æ¡ˆã€‚