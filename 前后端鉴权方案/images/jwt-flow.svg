<svg width="800" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">JWT (JSON Web Token) 鉴权流程图</text>
  
  <!-- Client -->
  <rect x="50" y="80" width="120" height="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
  <text x="110" y="115" text-anchor="middle" font-size="14" font-weight="bold" fill="#1976d2">客户端</text>
  
  <!-- Auth Server -->
  <rect x="350" y="80" width="120" height="60" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
  <text x="410" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#7b1fa2">认证服务器</text>
  <text x="410" y="125" text-anchor="middle" font-size="12" fill="#7b1fa2">(Auth Server)</text>
  
  <!-- Resource Server -->
  <rect x="630" y="80" width="120" height="60" fill="#e8f5e8" stroke="#4caf50" stroke-width="2" rx="5"/>
  <text x="690" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#4caf50">资源服务器</text>
  <text x="690" y="125" text-anchor="middle" font-size="12" fill="#4caf50">(Resource Server)</text>
  
  <!-- Step 1: Login Request -->
  <line x1="170" y1="160" x2="350" y2="160" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="260" y="155" text-anchor="middle" font-size="12" fill="#4caf50">1. 登录请求</text>
  
  <!-- Step 2: Generate JWT -->
  <line x1="350" y1="180" x2="170" y2="180" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="260" y="175" text-anchor="middle" font-size="12" fill="#ff9800">2. 返回 JWT</text>
  
  <!-- Step 3: API Request -->
  <line x1="170" y1="250" x2="630" y2="250" stroke="#2196f3" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="400" y="245" text-anchor="middle" font-size="12" fill="#2196f3">3. API请求 (携带JWT)</text>
  
  <!-- Step 4: Verify JWT -->
  <text x="690" y="230" text-anchor="middle" font-size="12" fill="#ff5722">4. 验证JWT</text>
  
  <!-- Step 5: Response -->
  <line x1="630" y1="270" x2="170" y2="270" stroke="#795548" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="400" y="265" text-anchor="middle" font-size="12" fill="#795548">5. 返回数据</text>
  
  <!-- JWT Structure -->
  <rect x="50" y="320" width="700" height="120" fill="#f5f5f5" stroke="#666" stroke-width="1" rx="5"/>
  <text x="60" y="340" font-size="14" font-weight="bold" fill="#333">JWT 结构：Header.Payload.Signature</text>
  
  <!-- Header -->
  <rect x="60" y="350" width="200" height="80" fill="#ffebee" stroke="#f44336" stroke-width="1" rx="3"/>
  <text x="70" y="370" font-size="12" font-weight="bold" fill="#f44336">Header (头部)</text>
  <text x="70" y="385" font-size="10" fill="#666" font-family="monospace">{</text>
  <text x="70" y="400" font-size="10" fill="#666" font-family="monospace">  "alg": "HS256",</text>
  <text x="70" y="415" font-size="10" fill="#666" font-family="monospace">  "typ": "JWT"</text>
  <text x="70" y="430" font-size="10" fill="#666" font-family="monospace">}</text>
  
  <!-- Payload -->
  <rect x="280" y="350" width="240" height="80" fill="#e8f5e8" stroke="#4caf50" stroke-width="1" rx="3"/>
  <text x="290" y="370" font-size="12" font-weight="bold" fill="#4caf50">Payload (载荷)</text>
  <text x="290" y="385" font-size="10" fill="#666" font-family="monospace">{</text>
  <text x="290" y="400" font-size="10" fill="#666" font-family="monospace">  "sub": "1234567890",</text>
  <text x="290" y="415" font-size="10" fill="#666" font-family="monospace">  "name": "John Doe",</text>
  <text x="290" y="430" font-size="10" fill="#666" font-family="monospace">  "iat": 1516239022</text>
  <text x="500" y="430" font-size="10" fill="#666" font-family="monospace">}</text>
  
  <!-- Signature -->
  <rect x="540" y="350" width="200" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="1" rx="3"/>
  <text x="550" y="370" font-size="12" font-weight="bold" fill="#1976d2">Signature (签名)</text>
  <text x="550" y="385" font-size="10" fill="#666">HMACSHA256(</text>
  <text x="550" y="400" font-size="10" fill="#666">  base64UrlEncode(header)</text>
  <text x="550" y="415" font-size="10" fill="#666">  + "." +</text>
  <text x="550" y="430" font-size="10" fill="#666">  base64UrlEncode(payload),</text>
  
  <!-- JWT Features -->
  <rect x="50" y="460" width="220" height="140" fill="#e8f5e8" stroke="#4caf50" stroke-width="1" rx="5"/>
  <text x="60" y="480" font-size="14" font-weight="bold" fill="#333">JWT 特点：</text>
  <text x="60" y="500" font-size="12" fill="#666">• 自包含，携带用户信息</text>
  <text x="60" y="520" font-size="12" fill="#666">• 无状态，服务端不存储</text>
  <text x="60" y="540" font-size="12" fill="#666">• 支持跨服务验证</text>
  <text x="60" y="560" font-size="12" fill="#666">• Base64编码，可读性好</text>
  <text x="60" y="580" font-size="12" fill="#666">• 通过签名防篡改</text>
  
  <!-- Refresh Token -->
  <rect x="290" y="460" width="220" height="140" fill="#fff3e0" stroke="#f57c00" stroke-width="1" rx="5"/>
  <text x="300" y="480" font-size="14" font-weight="bold" fill="#333">Refresh Token：</text>
  <text x="300" y="500" font-size="12" fill="#666">• 用于刷新Access Token</text>
  <text x="300" y="520" font-size="12" fill="#666">• 生命周期更长</text>
  <text x="300" y="540" font-size="12" fill="#666">• 存储在安全位置</text>
  <text x="300" y="560" font-size="12" fill="#666">• 可以被撤销</text>
  <text x="300" y="580" font-size="12" fill="#666">• 提高安全性</text>
  
  <!-- Security Considerations -->
  <rect x="530" y="460" width="220" height="140" fill="#ffebee" stroke="#f44336" stroke-width="1" rx="5"/>
  <text x="540" y="480" font-size="14" font-weight="bold" fill="#333">安全考虑：</text>
  <text x="540" y="500" font-size="12" fill="#666">• 使用HTTPS传输</text>
  <text x="540" y="520" font-size="12" fill="#666">• 设置合理过期时间</text>
  <text x="540" y="540" font-size="12" fill="#666">• 敏感信息不放Payload</text>
  <text x="540" y="560" font-size="12" fill="#666">• 密钥安全管理</text>
  <text x="540" y="580" font-size="12" fill="#666">• 实施Token黑名单</text>
  
  <!-- Legend -->
  <text x="50" y="640" font-size="14" font-weight="bold" fill="#333">图例：</text>
  <line x1="120" y1="635" x2="160" y2="635" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="170" y="640" font-size="12" fill="#666">请求/响应流程</text>
  
  <rect x="300" y="625" width="15" height="15" fill="#f44336" stroke="#f44336"/>
  <text x="325" y="637" font-size="12" fill="#666">Header</text>
  
  <rect x="380" y="625" width="15" height="15" fill="#4caf50" stroke="#4caf50"/>
  <text x="405" y="637" font-size="12" fill="#666">Payload</text>
  
  <rect x="470" y="625" width="15" height="15" fill="#1976d2" stroke="#1976d2"/>
  <text x="495" y="637" font-size="12" fill="#666">Signature</text>
</svg>