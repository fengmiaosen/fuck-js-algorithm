<svg width="900" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">OAuth 2.0 授权码流程图</text>
  
  <!-- User -->
  <rect x="50" y="80" width="100" height="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
  <text x="100" y="115" text-anchor="middle" font-size="14" font-weight="bold" fill="#1976d2">用户</text>
  
  <!-- Client App -->
  <rect x="250" y="80" width="120" height="60" fill="#e8f5e8" stroke="#4caf50" stroke-width="2" rx="5"/>
  <text x="310" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#4caf50">客户端应用</text>
  <text x="310" y="125" text-anchor="middle" font-size="12" fill="#4caf50">(Client App)</text>
  
  <!-- Auth Server -->
  <rect x="470" y="80" width="120" height="60" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
  <text x="530" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#7b1fa2">授权服务器</text>
  <text x="530" y="125" text-anchor="middle" font-size="12" fill="#7b1fa2">(Auth Server)</text>
  
  <!-- Resource Server -->
  <rect x="700" y="80" width="120" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
  <text x="760" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#f57c00">资源服务器</text>
  <text x="760" y="125" text-anchor="middle" font-size="12" fill="#f57c00">(Resource Server)</text>
  
  <!-- Step 1: Authorization Request -->
  <line x1="150" y1="180" x2="250" y2="180" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="200" y="175" text-anchor="middle" font-size="11" fill="#4caf50">1. 请求授权</text>
  
  <!-- Step 2: Redirect to Auth Server -->
  <line x1="310" y1="160" x2="470" y2="160" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="390" y="155" text-anchor="middle" font-size="11" fill="#ff9800">2. 重定向到授权服务器</text>
  
  <!-- Step 3: User Login -->
  <line x1="470" y1="200" x2="150" y2="200" stroke="#9c27b0" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="310" y="195" text-anchor="middle" font-size="11" fill="#9c27b0">3. 用户登录并授权</text>
  
  <!-- Step 4: Authorization Code -->
  <line x1="150" y1="220" x2="470" y2="220" stroke="#2196f3" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="310" y="215" text-anchor="middle" font-size="11" fill="#2196f3">4. 返回授权码</text>
  
  <!-- Step 5: Redirect with Code -->
  <line x1="470" y1="240" x2="250" y2="240" stroke="#ff5722" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="360" y="235" text-anchor="middle" font-size="11" fill="#ff5722">5. 重定向回客户端(带授权码)</text>
  
  <!-- Step 6: Exchange Code for Token -->
  <line x1="370" y1="280" x2="470" y2="280" stroke="#795548" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="420" y="275" text-anchor="middle" font-size="11" fill="#795548">6. 用授权码换取Token</text>
  
  <!-- Step 7: Access Token -->
  <line x1="470" y1="300" x2="370" y2="300" stroke="#607d8b" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="420" y="295" text-anchor="middle" font-size="11" fill="#607d8b">7. 返回Access Token</text>
  
  <!-- Step 8: API Request -->
  <line x1="370" y1="340" x2="700" y2="340" stroke="#3f51b5" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="535" y="335" text-anchor="middle" font-size="11" fill="#3f51b5">8. API请求(携带Token)</text>
  
  <!-- Step 9: Resource Response -->
  <line x1="700" y1="360" x2="370" y2="360" stroke="#009688" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="535" y="355" text-anchor="middle" font-size="11" fill="#009688">9. 返回受保护资源</text>
  
  <!-- OAuth Roles -->
  <rect x="50" y="420" width="200" height="160" fill="#f5f5f5" stroke="#666" stroke-width="1" rx="5"/>
  <text x="60" y="440" font-size="14" font-weight="bold" fill="#333">OAuth 2.0 角色：</text>
  <text x="60" y="460" font-size="12" fill="#1976d2" font-weight="bold">• 资源所有者 (User)</text>
  <text x="70" y="475" font-size="11" fill="#666">拥有受保护资源的实体</text>
  <text x="60" y="495" font-size="12" fill="#4caf50" font-weight="bold">• 客户端 (Client)</text>
  <text x="70" y="510" font-size="11" fill="#666">请求访问受保护资源的应用</text>
  <text x="60" y="530" font-size="12" fill="#7b1fa2" font-weight="bold">• 授权服务器 (Auth Server)</text>
  <text x="70" y="545" font-size="11" fill="#666">验证用户身份并颁发Token</text>
  <text x="60" y="565" font-size="12" fill="#f57c00" font-weight="bold">• 资源服务器 (Resource Server)</text>
  <text x="70" y="580" font-size="11" fill="#666">托管受保护资源的服务器</text>
  
  <!-- Grant Types -->
  <rect x="270" y="420" width="200" height="160" fill="#e8f5e8" stroke="#4caf50" stroke-width="1" rx="5"/>
  <text x="280" y="440" font-size="14" font-weight="bold" fill="#333">授权类型：</text>
  <text x="280" y="460" font-size="12" fill="#666">• 授权码模式 (推荐)</text>
  <text x="280" y="480" font-size="12" fill="#666">• 简化模式</text>
  <text x="280" y="500" font-size="12" fill="#666">• 密码模式</text>
  <text x="280" y="520" font-size="12" fill="#666">• 客户端凭证模式</text>
  <text x="280" y="540" font-size="12" fill="#666">• 设备码模式</text>
  <text x="280" y="560" font-size="12" fill="#666">• 刷新令牌</text>
  
  <!-- Security Features -->
  <rect x="490" y="420" width="200" height="160" fill="#fff3e0" stroke="#f57c00" stroke-width="1" rx="5"/>
  <text x="500" y="440" font-size="14" font-weight="bold" fill="#333">安全特性：</text>
  <text x="500" y="460" font-size="12" fill="#666">• 授权码与Token分离</text>
  <text x="500" y="480" font-size="12" fill="#666">• 客户端认证</text>
  <text x="500" y="500" font-size="12" fill="#666">• 作用域限制</text>
  <text x="500" y="520" font-size="12" fill="#666">• 状态参数防CSRF</text>
  <text x="500" y="540" font-size="12" fill="#666">• PKCE扩展</text>
  <text x="500" y="560" font-size="12" fill="#666">• Token过期机制</text>
  
  <!-- Use Cases -->
  <rect x="710" y="420" width="180" height="160" fill="#e3f2fd" stroke="#1976d2" stroke-width="1" rx="5"/>
  <text x="720" y="440" font-size="14" font-weight="bold" fill="#333">应用场景：</text>
  <text x="720" y="460" font-size="12" fill="#666">• 第三方登录</text>
  <text x="720" y="480" font-size="12" fill="#666">• API授权访问</text>
  <text x="720" y="500" font-size="12" fill="#666">• 微服务间调用</text>
  <text x="720" y="520" font-size="12" fill="#666">• 移动应用授权</text>
  <text x="720" y="540" font-size="12" fill="#666">• SPA应用</text>
  <text x="720" y="560" font-size="12" fill="#666">• 服务端应用</text>
  
  <!-- Legend -->
  <text x="50" y="620" font-size="14" font-weight="bold" fill="#333">图例：</text>
  <line x1="120" y1="615" x2="160" y2="615" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="170" y="620" font-size="12" fill="#666">授权流程</text>
  
  <text x="300" y="620" font-size="12" fill="#666">前端重定向</text>
  <line x1="380" y1="615" x2="420" y2="615" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <text x="450" y="620" font-size="12" fill="#666">后端API调用</text>
  <line x1="540" y1="615" x2="580" y2="615" stroke="#795548" stroke-width="2" marker-end="url(#arrowhead)"/>
</svg>