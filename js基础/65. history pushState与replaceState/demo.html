<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History API ä¸ popstate äº‹ä»¶æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #005a87;
        }
        .log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .clear-btn {
            background: #e53e3e;
        }
        .clear-btn:hover {
            background: #c53030;
        }
        .info {
            background: #bee3f8;
            border: 1px solid #90cdf4;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .current-state {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>History API ä¸ popstate äº‹ä»¶æ¼”ç¤º</h1>
    
    <div class="info">
        <strong>æ ¸å¿ƒè¦ç‚¹ï¼š</strong>
        <ul>
            <li>è°ƒç”¨ <code>history.pushState()</code> æˆ– <code>history.replaceState()</code> <strong>ä¸ä¼š</strong>è§¦å‘ <code>popstate</code> äº‹ä»¶</li>
            <li>åªæœ‰ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨å‰è¿›/åé€€æŒ‰é’®ï¼Œæˆ–è°ƒç”¨ <code>history.back()</code>ã€<code>history.forward()</code>ã€<code>history.go()</code> æ‰ä¼šè§¦å‘</li>
        </ul>
    </div>

    <div class="current-state">
        <h3>å½“å‰çŠ¶æ€</h3>
        <div id="currentInfo">
            <p><strong>URL:</strong> <span id="currentUrl"></span></p>
            <p><strong>State:</strong> <span id="currentState"></span></p>
            <p><strong>Title:</strong> <span id="currentTitle"></span></p>
        </div>
    </div>

    <div class="container">
        <h3>æµ‹è¯• pushState å’Œ replaceStateï¼ˆä¸ä¼šè§¦å‘ popstateï¼‰</h3>
        <button onclick="testPushState()">è°ƒç”¨ pushState</button>
        <button onclick="testReplaceState()">è°ƒç”¨ replaceState</button>
        <button onclick="testPushStateMultiple()">è¿ç»­è°ƒç”¨ pushState</button>
    </div>

    <div class="container">
        <h3>æµ‹è¯•ä¼šè§¦å‘ popstate çš„æ“ä½œ</h3>
        <button onclick="testBack()">è°ƒç”¨ history.back()</button>
        <button onclick="testForward()">è°ƒç”¨ history.forward()</button>
        <button onclick="testGo()">è°ƒç”¨ history.go(-1)</button>
        <p><em>æç¤ºï¼šä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»æµè§ˆå™¨çš„å‰è¿›/åé€€æŒ‰é’®æ¥è§¦å‘ popstate äº‹ä»¶</em></p>
    </div>

    <div class="container">
        <h3>å®é™…åº”ç”¨ï¼šç®€å•è·¯ç”±å™¨</h3>
        <button onclick="navigateToHome()">å¯¼èˆªåˆ°é¦–é¡µ</button>
        <button onclick="navigateToAbout()">å¯¼èˆªåˆ°å…³äºé¡µé¢</button>
        <button onclick="navigateToContact()">å¯¼èˆªåˆ°è”ç³»é¡µé¢</button>
        <div id="pageContent" style="margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 4px;">
            å½“å‰é¡µé¢ï¼šé¦–é¡µ
        </div>
    </div>

    <div class="container">
        <h3>äº‹ä»¶æ—¥å¿—</h3>
        <button class="clear-btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="eventLog" class="log"></div>
    </div>

    <script>
        let logCounter = 0;
        
        // æ—¥å¿—è®°å½•å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('eventLog');
            const color = type === 'event' ? '#4ade80' : type === 'action' ? '#60a5fa' : '#e2e8f0';
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${++logCounter}. ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            updateCurrentInfo();
        }
        
        // æ›´æ–°å½“å‰çŠ¶æ€æ˜¾ç¤º
        function updateCurrentInfo() {
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('currentState').textContent = JSON.stringify(history.state);
            document.getElementById('currentTitle').textContent = document.title;
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('eventLog').innerHTML = '';
            logCounter = 0;
        }
        
        // ç›‘å¬ popstate äº‹ä»¶
        window.addEventListener('popstate', function(event) {
            log(`ğŸ¯ popstate äº‹ä»¶è¢«è§¦å‘ï¼çŠ¶æ€: ${JSON.stringify(event.state)}`, 'event');
            
            // å¦‚æœæ˜¯è·¯ç”±çŠ¶æ€ï¼Œæ›´æ–°é¡µé¢å†…å®¹
            if (event.state && event.state.page) {
                updatePageContent(event.state.page, event.state.title);
            }
        });
        
        // æµ‹è¯• pushState
        function testPushState() {
            const state = { test: 'pushState', timestamp: Date.now() };
            const url = `/test-push-${Date.now()}`;
            
            log(`ğŸ“ è°ƒç”¨ history.pushState() - URL: ${url}`, 'action');
            history.pushState(state, 'Test Push', url);
            log(`âœ… pushState è°ƒç”¨å®Œæˆ - popstate æ²¡æœ‰è¢«è§¦å‘`, 'action');
        }
        
        // æµ‹è¯• replaceState
        function testReplaceState() {
            const state = { test: 'replaceState', timestamp: Date.now() };
            const url = `/test-replace-${Date.now()}`;
            
            log(`ğŸ“ è°ƒç”¨ history.replaceState() - URL: ${url}`, 'action');
            history.replaceState(state, 'Test Replace', url);
            log(`âœ… replaceState è°ƒç”¨å®Œæˆ - popstate æ²¡æœ‰è¢«è§¦å‘`, 'action');
        }
        
        // æµ‹è¯•è¿ç»­ pushState
        function testPushStateMultiple() {
            log(`ğŸ“ è¿ç»­è°ƒç”¨ pushState 3æ¬¡`, 'action');
            
            for (let i = 1; i <= 3; i++) {
                const state = { test: 'multiple', step: i };
                const url = `/test-multiple-${i}`;
                history.pushState(state, `Step ${i}`, url);
                log(`  ${i}. pushState å®Œæˆ - URL: ${url}`, 'action');
            }
            
            log(`âœ… è¿ç»­ pushState å®Œæˆ - popstate æ²¡æœ‰è¢«è§¦å‘`, 'action');
        }
        
        // æµ‹è¯• back
        function testBack() {
            log(`ğŸ”™ è°ƒç”¨ history.back() - è¿™ä¼šè§¦å‘ popstate`, 'action');
            history.back();
        }
        
        // æµ‹è¯• forward
        function testForward() {
            log(`ğŸ”œ è°ƒç”¨ history.forward() - è¿™ä¼šè§¦å‘ popstate`, 'action');
            history.forward();
        }
        
        // æµ‹è¯• go
        function testGo() {
            log(`â†©ï¸ è°ƒç”¨ history.go(-1) - è¿™ä¼šè§¦å‘ popstate`, 'action');
            history.go(-1);
        }
        
        // ç®€å•è·¯ç”±å™¨å®ç°
        function navigateToHome() {
            const state = { page: 'home', title: 'é¦–é¡µ' };
            log(`ğŸ  å¯¼èˆªåˆ°é¦–é¡µ - ä½¿ç”¨ pushState`, 'action');
            history.pushState(state, 'é¦–é¡µ', '/home');
            updatePageContent('home', 'é¦–é¡µ');
            log(`âœ… å¯¼èˆªå®Œæˆ - æ‰‹åŠ¨æ›´æ–°äº†é¡µé¢å†…å®¹`, 'action');
        }
        
        function navigateToAbout() {
            const state = { page: 'about', title: 'å…³äºé¡µé¢' };
            log(`â„¹ï¸ å¯¼èˆªåˆ°å…³äºé¡µé¢ - ä½¿ç”¨ pushState`, 'action');
            history.pushState(state, 'å…³äºé¡µé¢', '/about');
            updatePageContent('about', 'å…³äºé¡µé¢');
            log(`âœ… å¯¼èˆªå®Œæˆ - æ‰‹åŠ¨æ›´æ–°äº†é¡µé¢å†…å®¹`, 'action');
        }
        
        function navigateToContact() {
            const state = { page: 'contact', title: 'è”ç³»é¡µé¢' };
            log(`ğŸ“ å¯¼èˆªåˆ°è”ç³»é¡µé¢ - ä½¿ç”¨ pushState`, 'action');
            history.pushState(state, 'è”ç³»é¡µé¢', '/contact');
            updatePageContent('contact', 'è”ç³»é¡µé¢');
            log(`âœ… å¯¼èˆªå®Œæˆ - æ‰‹åŠ¨æ›´æ–°äº†é¡µé¢å†…å®¹`, 'action');
        }
        
        function updatePageContent(page, title) {
            const content = {
                'home': 'å½“å‰é¡µé¢ï¼šé¦–é¡µ - æ¬¢è¿æ¥åˆ°é¦–é¡µï¼',
                'about': 'å½“å‰é¡µé¢ï¼šå…³äºé¡µé¢ - è¿™é‡Œæ˜¯å…³äºæˆ‘ä»¬çš„ä¿¡æ¯ã€‚',
                'contact': 'å½“å‰é¡µé¢ï¼šè”ç³»é¡µé¢ - è”ç³»æ–¹å¼ï¼šexample@email.com'
            };
            
            document.getElementById('pageContent').textContent = content[page] || 'æœªçŸ¥é¡µé¢';
            document.title = title || 'æ¼”ç¤ºé¡µé¢';
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            log(`ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹ç›‘å¬ popstate äº‹ä»¶`, 'info');
            updateCurrentInfo();
            
            // è®¾ç½®åˆå§‹çŠ¶æ€
            const initialState = { page: 'home', title: 'é¦–é¡µ' };
            history.replaceState(initialState, 'é¦–é¡µ', window.location.pathname);
            log(`ğŸ“‹ è®¾ç½®åˆå§‹çŠ¶æ€å®Œæˆ`, 'info');
        });
        
        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                updateCurrentInfo();
            }
        });
    </script>
</body>
</html>